# Resumo da Aula Prática sobre Fundamentos da LGPD e Auditoria

## Introdução
Nesta aula prática, o professor explora como os fundamentos da Lei Geral de Proteção de Dados (LGPD), listados no artigo 2º, podem ser aplicados tecnicamente em um banco de dados PostgreSQL. A aula foca na criação de uma trilha de auditoria para promover **accountability** (responsabilização) e **prestação de contas**, utilizando extensões do PostgreSQL e gatilhos para registrar operações, alinhando-se aos princípios de privacidade, autodeterminação informativa, defesa do consumidor, direitos humanos, liberdade de expressão, desenvolvimento econômico e livre iniciativa.

## Fundamentos da LGPD (Artigo 2º)
Os fundamentos abordados incluem:
- **Respeito à Privacidade**: Proteger dados pessoais como extensão da identidade do titular.
- **Autodeterminação Informativa**: Garantir que o titular saiba e controle o uso de seus dados.
- **Liberdade de Expressão e Informação**: Promover transparência no tratamento de dados.
- **Desenvolvimento Econômico e Tecnológico**: Usar dados de forma responsável para inovação.
- **Livre Iniciativa**: Assegurar competição justa sem violar privacidade.
- **Defesa do Consumidor**: Respeitar os direitos do titular como consumidor.
- **Direitos Humanos**: Garantir dignidade e não discriminação no uso de dados.
Esses fundamentos servem como base ética e jurídica para projetar sistemas confiáveis e em conformidade com a LGPD.

## Configuração do Ambiente
O professor utiliza o ambiente criado anteriormente:
- **Container Docker**: `pg-lgpd`, com PostgreSQL.
- **Banco de Dados**: `lgpd_lab`, acessado via cliente `psql` com usuário `postgres`.
- **Esquema**: `privado`, contendo a tabela `pessoas`.

## Instalação de Extensões
Duas extensões são instaladas para suportar a auditoria:
- **pgCrypto**: Já instalada, oferece suporte à criptografia, reforçando a privacidade.
- **pg_stat_statements**: Registra estatísticas de consultas, promovendo transparência e segurança jurídica ao monitorar operações no banco.

## Criação da Tabela de Auditoria
Uma tabela chamada `auditoria_log` é criada no esquema `privado` para registrar operações:
- **Campos**:
  - `hora`: `TIMESTAMP WITH TIME ZONE`, com valor padrão `NOW()`, para registrar o momento da operação.
  - `ator`: `TEXT`, indicando o usuário do banco que realizou a ação.
  - `action`: `TEXT`, especificando a ação (ex.: `INSERT`, `UPDATE`, `DELETE`).
  - `objeto`: `TEXT`, identificando a tabela afetada (ex.: `privado.pessoas`).
  - `detalhes`: `JSONB`, armazenando informações detalhadas da operação (ex.: dados inseridos).
- **Finalidade**: Suportar **accountability**, permitindo rastrear quem fez o quê, quando e como, atendendo à autodeterminação informativa, defesa do consumidor e direitos humanos.

## Implementação de Função e Gatilho
- **Função `log_pessoa_inserida`**:
  - Criada com `CREATE OR REPLACE FUNCTION`, retorna uma trigger.
  - Insere automaticamente na tabela `auditoria_log` os detalhes de cada operação de `INSERT` na tabela `pessoas`.
  - Registra: usuário (`CURRENT_USER`), ação (`INSERT`), tabela (`privado.pessoas`) e dados inseridos (em formato `JSONB`).
  - Linguagem: PL/pgSQL.
- **Gatilho `tg_pessoas_insert`**:
  - Criado com `CREATE TRIGGER`, executado após cada `INSERT` na tabela `pessoas`.
  - Dispara a função `log_pessoa_inserida` para cada linha inserida.
Essa estrutura garante que todas as inserções sejam registradas automaticamente, promovendo **prestação de contas** e prevenção de abusos.

## Teste Prático
O professor realiza um teste de inserção na tabela `pessoas`:
- **Dados Inseridos**: Nome ("Ana Souza"), e-mail ("ana.souza@example.com"), CPF (exemplo) e data de nascimento ("2001-01-01").
- **Validação**: O e-mail, configurado como `UNIQUE`, impede duplicatas (o professor ajusta o e-mail para evitar erro).
- **Consulta à Auditoria**: Um `SELECT` na tabela `auditoria_log` confirma o registro da operação, mostrando:
  - Data e hora da inserção.
  - Usuário (`postgres`).
  - Ação (`INSERT`).
  - Tabela (`privado.pessoas`).
  - Detalhes em JSONB (nome, e-mail, CPF, data de nascimento).
Esse log demonstra transparência e permite ao titular verificar como seus dados foram tratados.

## Conexão com os Fundamentos da LGPD
A trilha de auditoria conecta-se diretamente aos fundamentos:
- **Privacidade e Autodeterminação Informativa**: O titular pode acessar o histórico de operações, sabendo quem manipulou seus dados.
- **Liberdade de Expressão e Informação**: A transparência do sistema é assegurada pelo log.
- **Desenvolvimento Econômico e Tecnológico**: Uso de recursos nativos do PostgreSQL reduz custos de compliance.
- **Livre Iniciativa e Defesa do Consumidor**: Auditoria aumenta a confiança, destacando organizações que respeitam os dados.
- **Direitos Humanos**: Garante dignidade ao controlar e documentar o uso de informações pessoais.

## Benefícios da Auditoria
A tabela de auditoria e o gatilho:
- **Prevenção**: Registram operações desde o início, evitando a necessidade de investigar apenas após incidentes.
- **Responsabilização**: Identificam quem realizou ações indevidas.
- **Transparência**: Facilitam auditorias e respostas à ANPD ou aos titulares.
- **Conformidade**: Alinham o sistema aos fundamentos da LGPD, reduzindo riscos legais.

## Conclusão
A aula prática demonstrou como implementar uma trilha de auditoria no PostgreSQL para traduzir os fundamentos da LGPD em soluções técnicas. A criação da tabela `auditoria_log`, da função e do gatilho garante **accountability** e **prestação de contas**, alinhando-se aos princípios de privacidade, autodeterminação informativa, transparência e direitos humanos. O teste de inserção comprovou a eficácia do sistema em registrar operações, promovendo confiança e conformidade. A próxima aula abordará conceitos como dado pessoal, dado sensível e titulares de dados, continuando a aplicação prática da LGPD.